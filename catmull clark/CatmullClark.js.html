<!DOCTYPE html>
<!-- saved from url=(0064)http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">   <title>CatmullClark.js</title>      <link rel="stylesheet" media="all" href="http://marcinignac.com/p/pex/docs/docco.css"> </head> <body>   <div id="container">     <div id="background"></div>     <!--            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">             <a class="source" href="../../../README.html">               <span class="file_name">README</span>             </a>                                           <a class="source " href="../../../pex/behaviors/Orbiter.html">                 <span class="base_path">pex / behaviors / </span><span class="file_name">Orbiter.js</span>               </a>                                           <a class="source " href="../../../pex/cameras/Arcball.html">                 <span class="base_path">pex / cameras / </span><span class="file_name">Arcball.js</span>               </a>                                           <a class="source " href="../../../pex/cameras/Cameras.html">                 <span class="base_path">pex / cameras / </span><span class="file_name">Cameras.js</span>               </a>                                           <a class="source " href="../../../pex/cameras/PerspectiveCamera.html">                 <span class="base_path">pex / cameras / </span><span class="file_name">PerspectiveCamera.js</span>               </a>                                           <a class="source " href="../../../pex/core/Color.html">                 <span class="base_path">pex / core / </span><span class="file_name">Color.js</span>               </a>                                           <a class="source " href="../../../pex/core/Context.html">                 <span class="base_path">pex / core / </span><span class="file_name">Context.js</span>               </a>                                           <a class="source " href="../../../pex/core/Core.html">                 <span class="base_path">pex / core / </span><span class="file_name">Core.js</span>               </a>                                           <a class="source " href="../../../pex/core/Edge.html">                 <span class="base_path">pex / core / </span><span class="file_name">Edge.js</span>               </a>                                           <a class="source " href="../../../pex/core/Face3.html">                 <span class="base_path">pex / core / </span><span class="file_name">Face3.js</span>               </a>                                           <a class="source " href="../../../pex/core/Face4.html">                 <span class="base_path">pex / core / </span><span class="file_name">Face4.js</span>               </a>                                           <a class="source " href="../../../pex/core/Fbo.html">                 <span class="base_path">pex / core / </span><span class="file_name">Fbo.js</span>               </a>                                           <a class="source " href="../../../pex/core/Geometry.html">                 <span class="base_path">pex / core / </span><span class="file_name">Geometry.js</span>               </a>                                           <a class="source " href="../../../pex/core/Mat4.html">                 <span class="base_path">pex / core / </span><span class="file_name">Mat4.js</span>               </a>                                           <a class="source " href="../../../pex/core/Material.html">                 <span class="base_path">pex / core / </span><span class="file_name">Material.js</span>               </a>                                           <a class="source " href="../../../pex/core/Mesh.html">                 <span class="base_path">pex / core / </span><span class="file_name">Mesh.js</span>               </a>                                           <a class="source " href="../../../pex/core/Program.html">                 <span class="base_path">pex / core / </span><span class="file_name">Program.js</span>               </a>                                           <a class="source " href="../../../pex/core/Quat.html">                 <span class="base_path">pex / core / </span><span class="file_name">Quat.js</span>               </a>                                           <a class="source " href="../../../pex/core/Ray.html">                 <span class="base_path">pex / core / </span><span class="file_name">Ray.js</span>               </a>                                           <a class="source " href="../../../pex/core/Rect.html">                 <span class="base_path">pex / core / </span><span class="file_name">Rect.js</span>               </a>                                           <a class="source " href="../../../pex/core/Spline.html">                 <span class="base_path">pex / core / </span><span class="file_name">Spline.js</span>               </a>                                           <a class="source " href="../../../pex/core/Texture2D.html">                 <span class="base_path">pex / core / </span><span class="file_name">Texture2D.js</span>               </a>                                           <a class="source " href="../../../pex/core/TextureCube.html">                 <span class="base_path">pex / core / </span><span class="file_name">TextureCube.js</span>               </a>                                           <a class="source " href="../../../pex/core/Vbo.html">                 <span class="base_path">pex / core / </span><span class="file_name">Vbo.js</span>               </a>                                           <a class="source " href="../../../pex/core/Vec2.html">                 <span class="base_path">pex / core / </span><span class="file_name">Vec2.js</span>               </a>                                           <a class="source " href="../../../pex/core/Vec3.html">                 <span class="base_path">pex / core / </span><span class="file_name">Vec3.js</span>               </a>                                           <a class="source " href="../../../pex/core/Vec4.html">                 <span class="base_path">pex / core / </span><span class="file_name">Vec4.js</span>               </a>                                           <a class="source " href="../../../pex/geom/BoundingBox.html">                 <span class="base_path">pex / geom / </span><span class="file_name">BoundingBox.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Cube.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Cube.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Geom.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Geom.js</span>               </a>                                           <a class="source selected" href="../../../pex/geom/hem/CatmullClark.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">CatmullClark.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/DooSabin.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">DooSabin.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/Extrude.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">Extrude.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEEdge.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEEdge.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEFace.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEFace.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEGeometryConverter.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEGeometryConverter.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEM.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEM.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEMesh.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEMesh.js</span>               </a>                                           <a class="source " href="../../../pex/geom/hem/HEVertex.html">                 <span class="base_path">pex / geom / hem / </span><span class="file_name">HEVertex.js</span>               </a>                                           <a class="source " href="../../../pex/geom/LineBuilder.html">                 <span class="base_path">pex / geom / </span><span class="file_name">LineBuilder.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Loft.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Loft.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Octree.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Octree.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Path.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Path.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Plane.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Plane.js</span>               </a>                                           <a class="source " href="../../../pex/geom/SimpleCube.html">                 <span class="base_path">pex / geom / </span><span class="file_name">SimpleCube.js</span>               </a>                                           <a class="source " href="../../../pex/geom/Sphere.html">                 <span class="base_path">pex / geom / </span><span class="file_name">Sphere.js</span>               </a>                                           <a class="source " href="../../../pex/lib/require.html">                 <span class="base_path">pex / lib / </span><span class="file_name">require.js</span>               </a>                                           <a class="source " href="../../../pex/lib/seedrandom.html">                 <span class="base_path">pex / lib / </span><span class="file_name">seedrandom.js</span>               </a>                                           <a class="source " href="../../../pex/lib/text.html">                 <span class="base_path">pex / lib / </span><span class="file_name">text.js</span>               </a>                                           <a class="source " href="../../../pex/materials/DiffuseMaterial.html">                 <span class="base_path">pex / materials / </span><span class="file_name">DiffuseMaterial.js</span>               </a>                                           <a class="source " href="../../../pex/materials/Materials.html">                 <span class="base_path">pex / materials / </span><span class="file_name">Materials.js</span>               </a>                                           <a class="source " href="../../../pex/materials/ShowColorMaterial.html">                 <span class="base_path">pex / materials / </span><span class="file_name">ShowColorMaterial.js</span>               </a>                                           <a class="source " href="../../../pex/materials/SolidColorMaterial.html">                 <span class="base_path">pex / materials / </span><span class="file_name">SolidColorMaterial.js</span>               </a>                                           <a class="source " href="../../../pex/materials/TestMaterial.html">                 <span class="base_path">pex / materials / </span><span class="file_name">TestMaterial.js</span>               </a>                                           <a class="source " href="../../../pex/materials/TexturedMaterial.html">                 <span class="base_path">pex / materials / </span><span class="file_name">TexturedMaterial.js</span>               </a>                                           <a class="source " href="../../../pex/node/events.html">                 <span class="base_path">pex / node / </span><span class="file_name">events.js</span>               </a>                                           <a class="source " href="../../../pex/node/fs.html">                 <span class="base_path">pex / node / </span><span class="file_name">fs.js</span>               </a>                                           <a class="source " href="../../../pex/node/path.html">                 <span class="base_path">pex / node / </span><span class="file_name">path.js</span>               </a>                                           <a class="source " href="../../../pex/node/plask.html">                 <span class="base_path">pex / node / </span><span class="file_name">plask.js</span>               </a>                                           <a class="source " href="../../../pex/node/sys.html">                 <span class="base_path">pex / node / </span><span class="file_name">sys.js</span>               </a>                                           <a class="source " href="../../../pex/pex-plask.html">                 <span class="base_path">pex / </span><span class="file_name">pex-plask.js</span>               </a>                                           <a class="source " href="../../../pex/pex-webgl.html">                 <span class="base_path">pex / </span><span class="file_name">pex-webgl.js</span>               </a>                                           <a class="source " href="../../../pex/pex.html">                 <span class="base_path">pex / </span><span class="file_name">pex.js</span>               </a>                                           <a class="source " href="../../../pex/sys/IO.html">                 <span class="base_path">pex / sys / </span><span class="file_name">IO.js</span>               </a>                                           <a class="source " href="../../../pex/sys/Sys.html">                 <span class="base_path">pex / sys / </span><span class="file_name">Sys.js</span>               </a>                                           <a class="source " href="../../../pex/sys/Window.html">                 <span class="base_path">pex / sys / </span><span class="file_name">Window.js</span>               </a>                                           <a class="source " href="../../../pex/util/GLUtils.html">                 <span class="base_path">pex / util / </span><span class="file_name">GLUtils.js</span>               </a>                                           <a class="source " href="../../../pex/util/Log.html">                 <span class="base_path">pex / util / </span><span class="file_name">Log.js</span>               </a>                                           <a class="source " href="../../../pex/util/ObjUtils.html">                 <span class="base_path">pex / util / </span><span class="file_name">ObjUtils.js</span>               </a>                                           <a class="source " href="../../../pex/util/RandUtils.html">                 <span class="base_path">pex / util / </span><span class="file_name">RandUtils.js</span>               </a>                                           <a class="source " href="../../../pex/util/Time.html">                 <span class="base_path">pex / util / </span><span class="file_name">Time.js</span>               </a>                                           <a class="source " href="../../../pex/util/Util.html">                 <span class="base_path">pex / util / </span><span class="file_name">Util.js</span>               </a>                        </div>         </div>       </div>          -->     <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               CatmullClark.js             </h1>             <div class="filepath">pex/geom/hem/</div>                                   </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html#section-1">¶</a>               </div>               <p>Catmull-Clark subdivision for half-edge meshes
Based on http://en.wikipedia.org/wiki/Catmull–Clark<em>subdivision</em>surface
Modified to follow Doo-Sabin scheme for new vertices 1/n<em>F + 1/n</em>R + (n-2)/n*v
http://www.cse.ohio-state.edu/~tamaldey/course/784/note20.pdf</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">([</span>
  <span class="s2">"pex/geom/hem/HEMesh"</span><span class="p">,</span>
  <span class="s2">"pex/geom/hem/HEVertex"</span><span class="p">,</span>
  <span class="s2">"pex/geom/hem/HEEdge"</span><span class="p">,</span>
  <span class="s2">"pex/geom/hem/HEFace"</span><span class="p">,</span>
  <span class="s2">"pex/core/Vec3"</span>
  <span class="p">],</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">HEMesh</span><span class="p">,</span> <span class="nx">HEVertex</span><span class="p">,</span> <span class="nx">HEEdge</span><span class="p">,</span> <span class="nx">HEFace</span><span class="p">,</span> <span class="nx">Vec3</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">CatmullClark</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="nx">CatmullClark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hemesh</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">hemesh</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html#section-2">¶</a>               </div>               <p>keep these numbers to iterate only over original faces/edges/vertices</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">numFaces</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">faces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">numEdges</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">edges</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">numVertices</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html#section-3">¶</a>               </div>               <p>For each face, add a face point - the centroid of all original
points for the respective face</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">numFaces</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">hemesh</span><span class="p">.</span><span class="nx">faces</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">facePoint</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">faces</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getCenter</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html#section-4">¶</a>               </div>               <p>For each edge, add an edge point - the average of
the two neighbouring face points and its two original endpoints.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">numEdges</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">edge</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">edges</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">edgePoint</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">edgePoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="nx">edgePoint</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">vert</span><span class="p">);</span>
      <span class="nx">edgePoint</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">vert</span><span class="p">);</span>
      <span class="nx">edgePoint</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">face</span><span class="p">.</span><span class="nx">facePoint</span><span class="p">);</span>
      <span class="nx">edgePoint</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">pair</span><span class="p">.</span><span class="nx">face</span><span class="p">.</span><span class="nx">facePoint</span><span class="p">);</span>
      <span class="nx">edgePoint</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
      <span class="nx">edge</span><span class="p">.</span><span class="nx">edgePoint</span> <span class="o">=</span> <span class="nx">edgePoint</span><span class="p">;</span>
      <span class="nx">edge</span><span class="p">.</span><span class="nx">pair</span><span class="p">.</span><span class="nx">edgePoint</span> <span class="o">=</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">edgePoint</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">numVertices</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">vertex</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">faceEdge</span> <span class="o">=</span> <span class="nx">vertex</span><span class="p">.</span><span class="nx">edge</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">face</span> <span class="o">=</span> <span class="nx">faceEdge</span><span class="p">.</span><span class="nx">face</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//average facePoint of neighbor faces</span>
      <span class="kd">var</span> <span class="nx">R</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//average edgePoint of neighbor edges</span>
      <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//num faces/edges</span>
      <span class="k">do</span> <span class="p">{</span>
        <span class="nx">F</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">face</span><span class="p">.</span><span class="nx">facePoint</span><span class="p">);</span>
        <span class="nx">R</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">faceEdge</span><span class="p">.</span><span class="nx">edgePoint</span><span class="p">);</span>
        <span class="o">++</span><span class="nx">n</span>
        <span class="nx">faceEdge</span> <span class="o">=</span> <span class="nx">faceEdge</span><span class="p">.</span><span class="nx">pair</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
        <span class="nx">face</span> <span class="o">=</span> <span class="nx">faceEdge</span><span class="p">.</span><span class="nx">face</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nx">faceEdge</span> <span class="o">!=</span> <span class="nx">vertex</span><span class="p">.</span><span class="nx">edge</span><span class="p">);</span>
      <span class="nx">F</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">n</span><span class="p">);</span>
      <span class="nx">R</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">n</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">newVert</span> <span class="o">=</span> <span class="nx">F</span><span class="p">.</span><span class="nx">dup</span><span class="p">();</span>
      <span class="nx">newVert</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">R</span><span class="p">.</span><span class="nx">scaled</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="nx">newVert</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">vertex</span><span class="p">.</span><span class="nx">scaled</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span>
      <span class="nx">newVert</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">n</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="http://marcinignac.com/p/pex/docs/pex/geom/hem/CatmullClark.html#section-5">¶</a>               </div>               <p>we can't simply duplicate vertex and make operations on it
as dup() returns Vec3 not HEVertex</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">vertex</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">newVert</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
      <span class="nx">vertex</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">newVert</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
      <span class="nx">vertex</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">newVert</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">numEdges</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">edges</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">numEdges</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">edge</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">edges</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">selected</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nx">edge</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">edge</span><span class="p">.</span><span class="nx">pair</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">edgePoint</span> <span class="o">=</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">edgePoint</span><span class="p">;</span>
      <span class="k">delete</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">edgePoint</span><span class="p">;</span>
      <span class="k">delete</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">pair</span><span class="p">.</span><span class="nx">edgePoint</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">newEdge</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">splitVertex</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">vert</span><span class="p">,</span> <span class="nx">edgePoint</span><span class="p">,</span> <span class="nx">edge</span><span class="p">,</span> <span class="nx">edge</span><span class="p">);</span>
      <span class="nx">edge</span><span class="p">.</span><span class="nx">edgePointVertex</span> <span class="o">=</span> <span class="nx">newEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">vert</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">numFaces</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">faces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">numFaces</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">face</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">faces</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">vert</span> <span class="o">=</span> <span class="nx">face</span><span class="p">.</span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">vert</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">edge</span> <span class="o">=</span> <span class="nx">face</span><span class="p">.</span><span class="nx">edge</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
      <span class="nx">vert</span><span class="p">.</span><span class="nx">edge</span> <span class="o">=</span> <span class="nx">edge</span><span class="p">;</span> <span class="c1">//to make sure we split the right face</span>
      <span class="kd">var</span> <span class="nx">newEdge</span> <span class="o">=</span> <span class="nx">hemesh</span><span class="p">.</span><span class="nx">splitVertex</span><span class="p">(</span><span class="nx">vert</span><span class="p">,</span> <span class="nx">face</span><span class="p">.</span><span class="nx">facePoint</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">nextEdge</span> <span class="o">=</span> <span class="nx">newEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
      <span class="k">do</span> <span class="p">{</span>
        <span class="nx">hemesh</span><span class="p">.</span><span class="nx">splitFace</span><span class="p">(</span><span class="nx">newEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">,</span> <span class="nx">nextEdge</span><span class="p">);</span>
        <span class="nx">nextEdge</span> <span class="o">=</span> <span class="nx">nextEdge</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">nextEdge</span> <span class="o">!=</span> <span class="nx">newEdge</span> <span class="o">&amp;&amp;</span> <span class="nx">nextEdge</span><span class="p">.</span><span class="nx">next</span> <span class="o">!=</span> <span class="nx">newEdge</span><span class="p">);</span>

      <span class="k">delete</span> <span class="nx">face</span><span class="p">.</span><span class="nx">faceVertex</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">hemesh</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">hemesh</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">CatmullClark</span><span class="p">;</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>     <!--          <div id="projectname">Pex</div>          -->   </div>    </body></html>